{% extends '../base.html' %}
{% load static %}
{% block content %}
  <div class="container py-5">
    <div class="row g-4">
      <!-- Product Images -->
      <div class="col-md-6">
        <div class="position-relative">
          <!-- Discount Badge (solo visible en variante de descuento) -->
          <!-- <span class="badge bg-danger discount-badge fs-6 p-2 d-none" id="discount-badge">-20%</span> -->
          
          <!-- Sold Out Overlay (solo visible en variante agotado) -->
          <!-- <div class="product-overlay rounded d-none" id="soldout-overlay">
            <span class="badge bg-secondary fs-5 p-3">AGOTADO</span>
          </div> -->
          
          <img src="https://placehold.co/600x600" alt="Product image" class="img-fluid rounded border mb-3" id="main-product-image">
        </div>
        <div class="position-relative px-4">
          <!-- Slider controls -->
          <button class="btn btn-sm btn-light rounded-circle position-absolute top-50 start-0 translate-middle-y z-1 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
            <i class="bi bi-chevron-left"></i>
          </button>
          
          <!-- Thumbnail slider -->
          <div class="thumbnail-slider py-2 gap-2">
            <img src="https://placehold.co/600x600" alt="Product thumbnail 1" class="rounded border p-1 product-thumbnail border-primary">
            <img src="https://placehold.co/600x600/e0e0e0/808080" alt="Product thumbnail 2" class="rounded border p-1 product-thumbnail">
            <img src="https://placehold.co/600x600/f0f0f0/909090" alt="Product thumbnail 3" class="rounded border p-1 product-thumbnail">
            <img src="https://placehold.co/600x600/d0d0d0/707070" alt="Product thumbnail 4" class="rounded border p-1 product-thumbnail">
            <img src="https://placehold.co/600x600/e5e5e5/858585" alt="Product thumbnail 5" class="rounded border p-1 product-thumbnail">
          </div>
          
          <button class="btn btn-sm btn-light rounded-circle position-absolute top-50 end-0 translate-middle-y z-1 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
      </div>

      <!-- Product Info -->
      <div class="col-md-6">
        <h1 class="fw-bold mb-2">Ergonomic Desk Chair</h1>
        
        <div class="d-flex align-items-center mb-3">
          <div class="me-3">
            <span class="rating"><i class="bi bi-star-fill"></i></span>
            <span class="rating"><i class="bi bi-star-fill"></i></span>
            <span class="rating"><i class="bi bi-star-fill"></i></span>
            <span class="rating"><i class="bi bi-star-fill"></i></span>
            <span class="rating-empty"><i class="bi bi-star"></i></span>
            <span class="ms-2 text-muted small">4.0 (24 reviews)</span>
          </div>
          <div class="vr mx-2 h-100"></div>
          <div class="d-flex align-items-center views-counter" id="views-counter">
            <i class="bi bi-eye text-muted me-1"></i>
            <span class="text-muted small" id="views-count">1,243 vistas</span>
          </div>
        </div>

        <!-- Precios (cambian según la variante) -->
        <div class="mb-3">
          <!-- Precio normal -->
          <h2 class="fs-2 fw-bold" id="price-normal">$299.99</h2>
          
          <!-- Precio con descuento -->
          <!-- <div class="d-none" id="price-discount">
            <div class="d-flex align-items-center gap-2">
              <h2 class="fs-2 fw-bold price-discount mb-0">$239.99</h2>
              <span class="fs-5 price-original">$299.99</span>
            </div>
            <p class="text-danger mt-1">Ahorras: $60.00 (20%)</p>
          </div> -->
        </div>

        <p class="text-muted mb-3">
          Experience ultimate comfort with our premium ergonomic desk chair. Designed to provide
          excellent lumbar support and promote good posture during long work hours.
        </p>

        <!-- Social Actions -->
        <div class="d-flex gap-2 mb-4">
          <button class="btn btn-outline-secondary d-flex align-items-center">
            <i class="bi bi-heart me-2"></i> Add to Wishlist
          </button>
          <button class="btn btn-outline-secondary d-flex align-items-center">
            <i class="bi bi-share me-2"></i> Share
          </button>
        </div>

        <!-- Botón de Añadir al Carrito (Simplificado) -->
        <div class="mt-4">
          <!-- Botón normal y con descuento -->
          <button class="btn btn-warning btn-lg w-100 d-flex align-items-center justify-content-center" id="btn-add-to-cart">
            <i class="bi bi-cart me-2"></i> Añadir al Carrito
          </button>
          
          <!-- Botón para producto agotado -->
          <!-- <button class="btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center d-none" id="btn-soldout" disabled>
            <i class="bi bi-cart me-2"></i> Añadir al Carrito
          </button> -->
        </div>
      </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="mt-5">
      <ul class="nav nav-tabs" id="productTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="true">Description</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">Reviews (24)</button>
        </li>
      </ul>
      <div class="tab-content pt-4" id="productTabsContent">
        <!-- Description Tab -->
        <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
          <div class="row">
            <div class="col-lg-10">
              <div class="mb-4">
                <p>
                  Our Ergonomic Desk Chair is designed with your comfort and health in mind. The chair features a breathable mesh back that provides excellent lumbar support, helping to maintain proper posture during long work hours.
                </p>
                <p>
                  The adjustable height and tilt mechanism allow you to customize the chair to your specific needs, while the padded armrests provide additional comfort. The sturdy five-wheel base ensures stability and easy movement across different floor surfaces.
                </p>
                <p>
                  Made from high-quality materials, this chair is built to last and provide years of comfortable seating. Whether you're working from home or in an office environment, our Ergonomic Desk Chair is the perfect addition to your workspace.
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Reviews Tab -->
        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
          <!-- Review Summary -->
          <div class="row mb-4">
            <div class="col-md-3 text-center text-md-start mb-4 mb-md-0">
              <div class="display-4 fw-bold">4.0</div>
              <div>
                <span class="rating"><i class="bi bi-star-fill"></i></span>
                <span class="rating"><i class="bi bi-star-fill"></i></span>
                <span class="rating"><i class="bi bi-star-fill"></i></span>
                <span class="rating"><i class="bi bi-star-fill"></i></span>
                <span class="rating-empty"><i class="bi bi-star"></i></span>
              </div>
              <div class="text-muted small mt-1">Based on 24 reviews</div>
            </div>
            <div class="col-md-9">
              <div class="d-flex align-items-center mb-2">
                <div class="text-muted me-2">5</div>
                <div class="progress flex-grow-1" style="height: 8px;">
                  <div class="progress-bar bg-warning" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="text-muted ms-2 small" style="width: 40px;">30%</div>
              </div>
              <div class="d-flex align-items-center mb-2">
                <div class="text-muted me-2">4</div>
                <div class="progress flex-grow-1" style="height: 8px;">
                  <div class="progress-bar bg-warning" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="text-muted ms-2 small" style="width: 40px;">60%</div>
              </div>
              <div class="d-flex align-items-center mb-2">
                <div class="text-muted me-2">3</div>
                <div class="progress flex-grow-1" style="height: 8px;">
                  <div class="progress-bar bg-warning" role="progressbar" style="width: 5%;" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="text-muted ms-2 small" style="width: 40px;">5%</div>
              </div>
              <div class="d-flex align-items-center mb-2">
                <div class="text-muted me-2">2</div>
                <div class="progress flex-grow-1" style="height: 8px;">
                  <div class="progress-bar bg-warning" role="progressbar" style="width: 3%;" aria-valuenow="3" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="text-muted ms-2 small" style="width: 40px;">3%</div>
              </div>
              <div class="d-flex align-items-center mb-2">
                <div class="text-muted me-2">1</div>
                <div class="progress flex-grow-1" style="height: 8px;">
                  <div class="progress-bar bg-warning" role="progressbar" style="width: 2%;" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="text-muted ms-2 small" style="width: 40px;">2%</div>
              </div>
            </div>
          </div>
          <div class="text-center mb-4">
            <button class="btn btn-warning" id="btn-write-review">
              <i class="bi bi-pencil me-2"></i> Escribir una reseña
            </button>
          </div>
          <hr>
          
          <!-- Individual Reviews -->
          <div class="mb-4">
            <!-- Review 1 -->
            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h5 class="mb-0">John Doe</h5>
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating-empty"><i class="bi bi-star"></i></span>
                    </div>
                    <span class="text-muted small">· 2 months ago</span>
                  </div>
                </div>
                <button class="btn btn-sm btn-link text-muted">Report</button>
              </div>
              <p>
                Great chair for the price. Very comfortable for long work sessions and the lumbar support is excellent. Assembly was straightforward and took about 20 minutes.
              </p>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary btn-like" data-likes="3">
                  <i class="bi bi-hand-thumbs-up me-1"></i> Me gusta (3)
                </button>
                <button class="btn btn-sm btn-link text-muted">Reply</button>
              </div>
            </div>
            <hr>
            
            <!-- Review 2 -->
            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h5 class="mb-0">Jane Smith</h5>
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                    </div>
                    <span class="text-muted small">· 1 month ago</span>
                  </div>
                </div>
                <button class="btn btn-sm btn-link text-muted">Report</button>
              </div>
              <p>
                This chair exceeded my expectations! The build quality is excellent and it's incredibly comfortable. I've been using it for 8+ hour workdays and have noticed a significant reduction in back pain.
              </p>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary btn-like" data-likes="3">
                  <i class="bi bi-hand-thumbs-up me-1"></i> Me gusta (3)
                </button>
                <button class="btn btn-sm btn-link text-muted">Reply</button>
              </div>
            </div>
            <hr>
            
            <!-- Review 3 -->
            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h5 class="mb-0">Robert Johnson</h5>
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating"><i class="bi bi-star-fill"></i></span>
                      <span class="rating-empty"><i class="bi bi-star"></i></span>
                      <span class="rating-empty"><i class="bi bi-star"></i></span>
                    </div>
                    <span class="text-muted small">· 3 weeks ago</span>
                  </div>
                </div>
                <button class="btn btn-sm btn-link text-muted">Report</button>
              </div>
              <p>
                The chair is decent for the price, but I found the armrests to be a bit wobbly. The lumbar support is good, but I wish the seat cushion was a bit thicker for longer sitting sessions.
              </p>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary btn-like" data-likes="3">
                  <i class="bi bi-hand-thumbs-up me-1"></i> Me gusta (3)
                </button>
                <button class="btn btn-sm btn-link text-muted">Reply</button>
              </div>
            </div>
          </div>
          
          <button class="btn btn-outline-primary w-100">Load More Reviews</button>
        </div>
      </div>
    </div>
  
  <!-- Related Products -->
  <div class="mt-5">
    <h2 class="fw-bold mb-4">You May Also Like</h2>
    <div class="row row-cols-1 row-cols-sm-3 row-cols-md-4 g-3">
      <!-- Product 1 -->
      <div class="col">
        <div class="card h-100 product-card">
          <img src="https://placehold.co/400x400" class="card-img-top" alt="Office Desk Lamp">
          <div class="card-body p-3">
            <h5 class="card-title fs-6 text-truncate">Office Desk Lamp</h5>
            <div class="d-flex align-items-center mb-1">
              <div class="me-1">
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating-empty"><i class="bi bi-star fs-6"></i></span>
              </div>
              <span class="text-muted small">(18)</span>
            </div>
            <p class="card-text fw-medium mb-0">$49.99</p>
          </div>
        </div>
      </div>
      
      <!-- Product 2 -->
      <div class="col">
        <div class="card h-100 product-card">
          <img src="https://placehold.co/400x400" class="card-img-top" alt="Wireless Keyboard">
          <div class="card-body p-3">
            <h5 class="card-title fs-6 text-truncate">Wireless Keyboard</h5>
            <div class="d-flex align-items-center mb-1">
              <div class="me-1">
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-half fs-6"></i></span>
              </div>
              <span class="text-muted small">(32)</span>
            </div>
            <p class="card-text fw-medium mb-0">$79.99</p>
          </div>
        </div>
      </div>
      
      <!-- Product 3 -->
      <div class="col">
        <div class="card h-100 product-card">
          <img src="https://placehold.co/400x400" class="card-img-top" alt="Monitor Stand">
          <div class="card-body p-3">
            <h5 class="card-title fs-6 text-truncate">Monitor Stand</h5>
            <div class="d-flex align-items-center mb-1">
              <div class="me-1">
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating-empty"><i class="bi bi-star fs-6"></i></span>
              </div>
              <span class="text-muted small">(14)</span>
            </div>
            <p class="card-text fw-medium mb-0">$39.99</p>
          </div>
        </div>
      </div>
      
      <!-- Product 4 -->
      <div class="col">
        <div class="card h-100 product-card">
          <img src="https://placehold.co/400x400" class="card-img-top" alt="Desk Organizer">
          <div class="card-body p-3">
            <h5 class="card-title fs-6 text-truncate">Desk Organizer</h5>
            <div class="d-flex align-items-center mb-1">
              <div class="me-1">
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-fill fs-6"></i></span>
                <span class="rating"><i class="bi bi-star-half fs-6"></i></span>
                <span class="rating-empty"><i class="bi bi-star fs-6"></i></span>
              </div>
              <span class="text-muted small">(23)</span>
            </div>
            <p class="card-text fw-medium mb-0">$24.99</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<!-- Modal para Añadir al Carrito -->
<div class="modal fade" id="addToCartModal" tabindex="-1" aria-labelledby="addToCartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addToCartModalLabel">Añadir al Carrito</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex mb-3">
          <!-- Imagen del producto -->
          <div class="me-3">
            <img src="https://placehold.co/600x600" alt="Product image" class="modal-product-img rounded border" id="modal-product-image">
          </div>
          <!-- Información del producto -->
          <div>
            <h5 class="mb-2">Ergonomic Desk Chair</h5>
            <!-- Precio normal -->
            <div id="modal-price-normal">
              <p class="fw-bold mb-1">$299.99</p>
            </div>
            <!-- Precio con descuento -->
            <div id="modal-price-discount" class="d-none">
              <p class="fw-bold mb-1 price-discount">$239.99 <span class="price-original small">$299.99</span></p>
            </div>
            <p class="text-muted small mb-0">Color: <span id="selected-color">Black</span></p>
          </div>
        </div>
        
        <div class="mb-3">
          <label for="modal-quantity" class="form-label">Cantidad</label>
          <div class="input-group">
            <button class="btn btn-outline-secondary" type="button" id="modal-btn-minus">
              <i class="bi bi-dash"></i>
            </button>
            <input type="text" class="form-control text-center" value="1" id="modal-quantity">
            <button class="btn btn-outline-secondary" type="button" id="modal-btn-plus">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        
        <div class="alert alert-success d-none" id="modal-success-message">
          <i class="bi bi-check-circle me-2"></i> Producto añadido al carrito correctamente.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-warning" id="modal-add-to-cart">
          <i class="bi bi-cart me-2"></i> Añadir al Carrito
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="writeReviewModal" tabindex="-1" aria-labelledby="writeReviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="writeReviewModalLabel">Escribir una Reseña</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="review-form">
          <!-- Calificación con estrellas -->
          <div class="mb-4">
            <label class="form-label fw-medium">Calificación</label>
            <div class="star-rating" id="star-rating">
              <i class="bi bi-star" data-rating="1"></i>
              <i class="bi bi-star" data-rating="2"></i>
              <i class="bi bi-star" data-rating="3"></i>
              <i class="bi bi-star" data-rating="4"></i>
              <i class="bi bi-star" data-rating="5"></i>
            </div>
            <input type="hidden" name="rating" id="selected-rating" value="0" required>
            <div class="invalid-feedback">Por favor, selecciona una calificación.</div>
          </div>
          
          <!-- Comentario de la reseña -->
          <div class="mb-3">
            <label for="review-comment" class="form-label fw-medium">Comentario</label>
            <textarea class="form-control" id="review-comment" rows="4" placeholder="Comparte tu experiencia con este producto" required></textarea>
            <div class="invalid-feedback">Por favor, ingresa un comentario.</div>
          </div>
          
          <div class="alert alert-success d-none" id="review-success-message">
            <i class="bi bi-check-circle me-2"></i> ¡Gracias! Tu reseña ha sido enviada correctamente y será publicada después de ser revisada.
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-warning" id="submit-review">
          <i class="bi bi-send me-2"></i> Enviar Reseña
        </button>
      </div>
    </div>
  </div>
</div>

  <!-- Bootstrap JS Bundle with Popper -->
  <!-- Script para manejar las variantes de producto y funcionalidad -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar variables
      const addToCartBtn = document.getElementById('btn-add-to-cart');
      const soldOutBtn = document.getElementById('btn-soldout');
      const modalAddToCartBtn = document.getElementById('modal-add-to-cart');
      const modalQuantity = document.getElementById('modal-quantity');
      const modalBtnMinus = document.getElementById('modal-btn-minus');
      const modalBtnPlus = document.getElementById('modal-btn-plus');
      const modalSuccessMessage = document.getElementById('modal-success-message');
      const modalPriceNormal = document.getElementById('modal-price-normal');
      const modalPriceDiscount = document.getElementById('modal-price-discount');
      const modalProductImage = document.getElementById('modal-product-image');
      const viewsCounter = document.getElementById('views-counter');
      const viewsCount = document.getElementById('views-count');
      const writeReviewBtn = document.getElementById('btn-write-review');
      const submitReviewBtn = document.getElementById('submit-review');
      const reviewForm = document.getElementById('review-form');
      const reviewSuccessMessage = document.getElementById('review-success-message');
      const starRating = document.getElementById('star-rating');
      const selectedRating = document.getElementById('selected-rating');
      const likeButtons = document.querySelectorAll('.btn-like');
      
      // Inicializar los modales
      const addToCartModal = new bootstrap.Modal(document.getElementById('addToCartModal'));
      const writeReviewModal = new bootstrap.Modal(document.getElementById('writeReviewModal'));

      likeButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Verificar si el botón ya está activo
          const isActive = this.classList.contains('active');
          
          if (isActive) {
            // Si ya está activo, quitar el like
            const currentLikes = parseInt(this.getAttribute('data-likes'));
            this.setAttribute('data-likes', currentLikes - 1);
            this.innerHTML = `<i class="bi bi-hand-thumbs-up me-1"></i> Me gusta (${currentLikes - 1})`;
            this.classList.remove('active');
          } else {
            // Si no está activo, añadir el like
            const currentLikes = parseInt(this.getAttribute('data-likes'));
            this.setAttribute('data-likes', currentLikes + 1);
            this.innerHTML = `<i class="bi bi-hand-thumbs-up-fill me-1"></i> Me gusta (${currentLikes + 1})`;
            this.classList.add('active');
          }
        });
      });
      
      // Manejar la selección de estrellas
      if (starRating) {
        const stars = starRating.querySelectorAll('i');
        
        stars.forEach(star => {
          star.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            selectedRating.value = rating;
            
            // Actualizar la visualización de las estrellas
            stars.forEach(s => {
              const starRating = parseInt(s.getAttribute('data-rating'));
              if (starRating <= rating) {
                s.classList.remove('bi-star');
                s.classList.add('bi-star-fill', 'active');
              } else {
                s.classList.remove('bi-star-fill', 'active');
                s.classList.add('bi-star');
              }
            });
          });
          
          // Efecto hover para mostrar estrellas al pasar el mouse
          star.addEventListener('mouseenter', function() {
            const hoverRating = parseInt(this.getAttribute('data-rating'));
            
            stars.forEach(s => {
              const starRating = parseInt(s.getAttribute('data-rating'));
              if (starRating <= hoverRating) {
                s.classList.remove('bi-star');
                s.classList.add('bi-star-fill');
              } else {
                s.classList.remove('bi-star-fill');
                s.classList.add('bi-star');
              }
            });
          });
          
          // Restaurar estrellas al quitar el mouse
          starRating.addEventListener('mouseleave', function() {
            const rating = parseInt(selectedRating.value);
            
            stars.forEach(s => {
              const starRating = parseInt(s.getAttribute('data-rating'));
              if (starRating <= rating) {
                s.classList.remove('bi-star');
                s.classList.add('bi-star-fill', 'active');
              } else {
                s.classList.remove('bi-star-fill', 'active');
                s.classList.add('bi-star');
              }
            });
          });
        });
      }
      
      // Evento para abrir el modal de escribir reseña
      writeReviewBtn.addEventListener('click', function() {
        // Resetear el formulario
        reviewForm.reset();
        reviewSuccessMessage.classList.add('d-none');
        
        // Resetear las estrellas
        const stars = starRating.querySelectorAll('i');
        stars.forEach(s => {
          s.classList.remove('bi-star-fill', 'active');
          s.classList.add('bi-star');
        });
        selectedRating.value = 0;
        
        // Mostrar el modal
        writeReviewModal.show();
      });
      
      // Evento para enviar la reseña
      submitReviewBtn.addEventListener('click', function() {
        // Validar el formulario
        const form = document.getElementById('review-form');
        if (!form.checkValidity()) {
          // Mostrar mensajes de validación
          form.classList.add('was-validated');
          return;
        }
        
        // Verificar que se haya seleccionado una calificación
        if (selectedRating.value === '0') {
          form.classList.add('was-validated');
          return;
        }
        
        // Mostrar mensaje de éxito
        reviewSuccessMessage.classList.remove('d-none');
        
        // Deshabilitar el botón temporalmente
        submitReviewBtn.disabled = true;
        
        // Simular envío de reseña
        setTimeout(function() {
          // Habilitar el botón nuevamente
          submitReviewBtn.disabled = false;
          
          // Cerrar el modal después de un breve retraso
          setTimeout(function() {
            writeReviewModal.hide();
            form.classList.remove('was-validated');
          }, 2000);
        }, 1500);
      });
      
      // Simular incremento de vistas
      let currentViews = 1243;
      
      // Función para actualizar el contador de vistas
      function updateViewsCounter() {
        // Incrementar vistas aleatoriamente
        if (Math.random() > 0.7) {
          currentViews += Math.floor(Math.random() * 3) + 1;
          viewsCount.textContent = currentViews.toLocaleString() + ' vistas';
          
          // Aplicar animación
          viewsCounter.classList.remove('views-counter');
          void viewsCounter.offsetWidth; // Truco para reiniciar la animación
          viewsCounter.classList.add('views-counter');
        }
      }
      
      // Actualizar vistas periódicamente
      setInterval(updateViewsCounter, 5000);
      
      // Incrementar vistas al cargar la página
      currentViews++;
      viewsCount.textContent = currentViews.toLocaleString() + ' vistas';
      
      // Evento para abrir el modal al hacer clic en "Añadir al Carrito"
      addToCartBtn.addEventListener('click', function() {
        // Actualizar la imagen del modal con la imagen principal seleccionada
        modalProductImage.src = document.getElementById('main-product-image').src;
        
        // Resetear el mensaje de éxito
        modalSuccessMessage.classList.add('d-none');
        
        // Mostrar el modal
        addToCartModal.show();
      });
      
      // Controles de cantidad en el modal
      modalBtnMinus.addEventListener('click', function() {
        let value = parseInt(modalQuantity.value);
        if (value > 1) {
          modalQuantity.value = value - 1;
        }
      });
      
      modalBtnPlus.addEventListener('click', function() {
        let value = parseInt(modalQuantity.value);
        modalQuantity.value = value + 1;
      });
      
      // Añadir al carrito desde el modal
      modalAddToCartBtn.addEventListener('click', function() {
        // Mostrar mensaje de éxito
        modalSuccessMessage.classList.remove('d-none');
        
        // Deshabilitar el botón temporalmente
        modalAddToCartBtn.disabled = true;
        
        // Simular añadir al carrito
        setTimeout(function() {
          // Habilitar el botón nuevamente
          modalAddToCartBtn.disabled = false;
          
          // Cerrar el modal después de un breve retraso
          setTimeout(function() {
            addToCartModal.hide();
          }, 1500);
        }, 1000);
      });
      
      // Thumbnail slider navigation
      const slider = document.querySelector('.thumbnail-slider');
      const prevBtn = document.querySelector('.btn-light:first-child');
      const nextBtn = document.querySelector('.btn-light:last-child');
      const thumbnails = document.querySelectorAll('.product-thumbnail');
      
      // Scroll slider left/right
      prevBtn.addEventListener('click', function() {
        slider.scrollBy({ left: -200, behavior: 'smooth' });
      });
      
      nextBtn.addEventListener('click', function() {
        slider.scrollBy({ left: 200, behavior: 'smooth' });
      });
      
      // Change main image when clicking thumbnails
      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', function() {
          // Remove active class from all thumbnails
          thumbnails.forEach(t => {
            t.classList.remove('border-primary');
          });
          
          // Add active class to clicked thumbnail
          this.classList.add('border-primary');
          
          // Update main image
          const mainImage = document.getElementById('main-product-image');
          mainImage.src = this.src;
        });
      });
    });
  </script>
{% endblock %}